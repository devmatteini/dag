use crate::cli::parse_repository::try_parse_repository;
use crate::github::Repository;
use std::path::PathBuf;
use structopt::StructOpt;

#[derive(Debug, StructOpt)]
#[structopt(
    name = "dra",
    about = "A command line tool to download release assets from GitHub"
)]
pub struct Cli {
    #[structopt(subcommand)]
    pub cmd: Command,

    /// Github repository using format {owner}/{repo}
    #[structopt(parse(try_from_str = try_parse_repository))]
    pub repo: Repository,
}

#[derive(Debug, StructOpt)]
pub enum Command {
    /// Select and download an asset
    Download {
        /// Untagged asset name to automatically select which asset to download
        ///
        /// Usually this value is generated by the command `untag`
        #[structopt(short = "s", long = "select")]
        select: Option<String>,

        /// Set the tag name for fetching a specific release
        ///
        /// Latest release is used if not specified
        #[structopt(short = "t", long = "tag")]
        tag: Option<String>,

        /// Save asset to custom path
        ///
        /// Default path is current working directory and the name of the asset
        #[structopt(short = "o", long = "output", parse(from_os_str))]
        output: Option<PathBuf>,
    },

    /// Select an asset and generate an untagged version of it
    Untag,
}
